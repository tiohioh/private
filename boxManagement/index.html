<!--引っ越し用段ボール管理アプリ-->
<head>
	<meta charset="utf-8"/>
	<title>段ボール管理用</title>
	<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
	<h1>段ボール管理</h1>
	<canvas id="qrviwer"></canvas>
	<input id="dat" type="text"></input>
</body>
<script>
const video = document.createElement("video");
const canvasElem = document.getElementById("qrviwer");
const canvas = canvasElem.getContext("2d");

let isReadQR = false;

navigator.mediaDevices.getUserMedia({video: {facingMode: 'environment'}})
.then(stream => {
	video.srcObject = stream;
	video.setAttribute('playsinline', true);
	video.play();
	requestAnimationFrame(tick);
});
console.log('LD END');

function tick() {
	if(true || video.redyState === video.HAVE_ENOUGH_DATA){
		canvasElem.height = 640;
		canvasElem.width = 640;
		canvas.drawImage(video, 0, 0, canvasElem.height, canvasElem.width, 0, 0, 640, 640);
		var imageData = canvas.getImageData(0, 0, canvasElem.height, canvasElem.width);
		var code = jsQR(imageData.data, imageData.width, imageData.height, {
			inversionAttempts: 'dontInvert',
		});
		if(code)
			document.getElementById('dat').value = code.data;
	}
	requestAnimationFrame(tick);
}
</script>
